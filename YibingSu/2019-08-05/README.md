# php中的COW机制


>来自: [深入理解PHP内核](http://www.php-internals.com/book/?p=chapt06/06-06-copy-on-write)

先看一段简单的代码
``` php
<?php
    $foo = 1;
    $bar = $foo;
    echo $foo + $bar;
```
  执行这段代码，会打印出数字2。从内存的角度来分析一下这段代码**“可能”**是这样执行的： 分配一块内存给foo变量，里面存储一个1； 再分配一块内存给bar变量，也存一个1，最后计算出结果输出。 事实上，我们发现foo和bar变量因为**值相同**，完全可以**使用同一块内存**，这样，内存的使用就节省了一个1， 并且，还省去了分配内存和管理内存地址的计算开销。 没错，很多涉及到内存管理的系统，都实现了这种**相同值共享内存**的策略：写时复制